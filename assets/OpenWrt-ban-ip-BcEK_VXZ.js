import{_ as d}from"./ValaxyMain.vue_vue_type_style_index_0_lang-068IHmgZ.js";import{c as g,w as a,f as y,a as E,p,o as C,g as i,q as s,m as B,r as k}from"./app-DYthNE-R.js";import"./YunFooter-Zae0V-5m.js";import"./YunCard.vue_vue_type_script_setup_true_lang-DAcOL4KL.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang-BhN51dU1.js";import"./index-C7yU5XnD.js";const b={__name:"OpenWrt-ban-ip",setup(D,{expose:F}){const t=JSON.parse('{"title":"OpenWrt自动封禁爆破IP","description":"","frontmatter":{"title":"OpenWrt自动封禁爆破IP","date":"2022-09-20T00:00:00.000Z","updated":"2023-09-20T00:00:00.000Z","categories":"Yr的学习","tags":["openwrt","linux"]},"headers":[{"level":2,"title":"需求","slug":"需求","link":"#需求","children":[{"level":3,"title":"个性化需求","slug":"个性化需求","link":"#个性化需求","children":[]},{"level":3,"title":"安装邮件通知功能","slug":"安装邮件通知功能","link":"#安装邮件通知功能","children":[]}]},{"level":2,"title":"项目地址","slug":"项目地址","link":"#项目地址","children":[]},{"level":2,"title":"初始源码","slug":"初始源码","link":"#初始源码","children":[]},{"level":2,"title":"实际使用源码（邮件通知BUG，后续修复）","slug":"实际使用源码-邮件通知bug-后续修复","link":"#实际使用源码-邮件通知bug-后续修复","children":[{"level":3,"title":"添加修改自定义功能","slug":"添加修改自定义功能","link":"#添加修改自定义功能","children":[]},{"level":3,"title":"封禁IP通知发送至邮箱","slug":"封禁ip通知发送至邮箱","link":"#封禁ip通知发送至邮箱","children":[]},{"level":3,"title":"DenyPwdHack.sh（集成自定义功能版）","slug":"denypwdhack-sh-集成自定义功能版","link":"#denypwdhack-sh-集成自定义功能版","children":[]},{"level":3,"title":"添加计划任务","slug":"添加计划任务","link":"#添加计划任务","children":[]},{"level":3,"title":"查询","slug":"查询","link":"#查询","children":[]}]},{"level":2,"title":"邮件通知BUG修复","slug":"邮件通知bug修复","link":"#邮件通知bug修复","children":[{"level":3,"title":"改进","slug":"改进","link":"#改进","children":[]},{"level":3,"title":"检测MD5脚本","slug":"检测md5脚本","link":"#检测md5脚本","children":[]},{"level":3,"title":"DenyPwdHack.sh（改进后命令）","slug":"denypwdhack-sh-改进后命令","link":"#denypwdhack-sh-改进后命令","children":[]}]}],"relativePath":"pages/posts/OpenWrt-ban-ip.md","path":"/home/runner/work/yrredcrew.github.io/yrredcrew.github.io/pages/posts/OpenWrt-ban-ip.md","lastUpdated":1727593238000}'),e=E(),n=t.frontmatter||{};return e.meta.frontmatter=Object.assign(e.meta.frontmatter||{},t.frontmatter||{}),p("pageData",t),p("valaxy:frontmatter",n),globalThis.$frontmatter=n,F({frontmatter:{title:"OpenWrt自动封禁爆破IP",date:"2022-09-20T00:00:00.000Z",updated:"2023-09-20T00:00:00.000Z",categories:"Yr的学习",tags:["openwrt","linux"]}}),(l,h)=>{const r=d;return C(),g(r,{frontmatter:y(n)},{"main-content-md":a(()=>[h[0]||(h[0]=i("h2",{id:"需求",tabindex:"-1"},[s("需求 "),i("a",{class:"header-anchor",href:"#需求","aria-label":'Permalink to "需求"'},"​")],-1)),h[1]||(h[1]=i("ul",null,[i("li",null,"OpenWrt没有自动封禁IP的功能，在GitHub找到遍历Log封禁IP脚本。")],-1)),h[2]||(h[2]=i("h3",{id:"个性化需求",tabindex:"-1"},[s("个性化需求 "),i("a",{class:"header-anchor",href:"#个性化需求","aria-label":'Permalink to "个性化需求"'},"​")],-1)),h[3]||(h[3]=i("ul",null,[i("li",null,[s("添加封禁IP脚本"),i("code",null,"DenyPwdHack.sh"),s("（无邮件通知，且遍历logread系统日志。导致IP存在就会封禁无法过期删除。）")]),i("li",null,[s("配置封禁IP脚本"),i("code",null,"DenyPwdHack.sh"),s("的遍历logread系统日志最后100行。")]),i("li",null,[s("添加封禁IP脚本"),i("code",null,"DenyPwdHack.sh"),s("的封禁IP通知发送至邮箱。")])],-1)),B(" more "),h[4]||(h[4]=i("h3",{id:"安装邮件通知功能",tabindex:"-1"},[s("安装邮件通知功能 "),i("a",{class:"header-anchor",href:"#安装邮件通知功能","aria-label":'Permalink to "安装邮件通知功能"'},"​")],-1)),h[5]||(h[5]=i("ul",null,[i("li",null,"OpenWrt安装msmtp、mutt。"),i("li",null,"msmtp添加发送邮件功能。"),i("li",null,"mutt邮件客户端，使邮件正常发送，对端不误报垃圾邮件。")],-1)),h[6]||(h[6]=i("h4",{id:"配置msmtp",tabindex:"-1"},[s("配置msmtp "),i("a",{class:"header-anchor",href:"#配置msmtp","aria-label":'Permalink to "配置msmtp"'},"​")],-1)),h[7]||(h[7]=i("ul",null,[i("li",null,[i("code",null,"vim /etc/msmtprc")])],-1)),h[8]||(h[8]=i("div",{style:{"max-height":"300px"},class:"language-php vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"php"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# Example for a system wide configuration file")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# A system wide configuration file is optional.")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# If it exists, it usually defines a default account.")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# This allows msmtp to be used like /usr/sbin/sendmail.")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"account"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," default")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# The SMTP smarthost")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"host"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," smtp.163"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"com"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," // 163邮箱smtp地址")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# Use TLS on port 465")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"port"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 465")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"tls"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," on")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"tls_starttls"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," off")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},'# Construct envelope-from addresses of the form "user@oursite.example"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"from"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," xxxxxxxx"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"@"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"163.com"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," // 邮件的发件方地址")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"auth"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," login"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," // 自动登录")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"user"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," xxxxxxxx"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"@"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"163.com"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," // 邮箱用户名，有些是不要@邮箱地址")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"password"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," XXXXXXXXXXXXX"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," // 邮箱开启SMTP给的授权码")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# Syslog logging with facility LOG_MAIL instead of the default LOG_USER")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"logfile"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," /"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"etc"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"/"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"msmtp"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"log")])])]),i("button",{class:"collapse"})],-1)),h[9]||(h[9]=i("h4",{id:"配置mutt",tabindex:"-1"},[s("配置mutt "),i("a",{class:"header-anchor",href:"#配置mutt","aria-label":'Permalink to "配置mutt"'},"​")],-1)),h[10]||(h[10]=i("ul",null,[i("li",null,[i("code",null,"vim /etc/Muttrc")])],-1)),h[11]||(h[11]=i("div",{style:{"max-height":"300px"},class:"language-php vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"php"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"set"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," charset"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"utf-8"')]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"set"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," rfc2047_parameters"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"yes")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"set"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," envelope_from"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"yes")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"set"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," sendmail"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"/usr/bin/msmtp"'),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," //发邮件的程序")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"set"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," use_from"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"yes")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"set"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," from"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"xxxxxxxx"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"@"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"163.com"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," //发件方")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"set"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," realname"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"OpenWrt"'),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," //发件方名称")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"set"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," editor"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"vim"')])])]),i("button",{class:"collapse"})],-1)),h[12]||(h[12]=i("h2",{id:"项目地址",tabindex:"-1"},[s("项目地址 "),i("a",{class:"header-anchor",href:"#项目地址","aria-label":'Permalink to "项目地址"'},"​")],-1)),h[13]||(h[13]=i("ul",null,[i("li",null,[i("a",{href:"https://github.com/xwsnet/deny-ssh-password-attack",target:"_blank",rel:"noreferrer"},"项目地址")])],-1)),h[14]||(h[14]=i("h2",{id:"初始源码",tabindex:"-1"},[s("初始源码 "),i("a",{class:"header-anchor",href:"#初始源码","aria-label":'Permalink to "初始源码"'},"​")],-1)),h[15]||(h[15]=i("div",{style:{"max-height":"300px"},class:"language-php vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"php"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"#!/bin/ash")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## OpenWRT 版本判断")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"Vfile"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=/"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"etc"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"/"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"banner")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"OWTV"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},`\`awk 'BEGIN{IGNORECASE=1}/openwrt/ {split($2,v,"."); print v[1]}' `),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$Vfile"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"`")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[[ $OWTV "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"lt"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 18"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]] "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&&"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," echo"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "OpenWRT version must be >= 18"'),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," &&"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," exit"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 黑名单所在iptables链表")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"ChainName"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"DenyPwdHack")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 日志路径")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"LOG_DEST"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=/"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"tmp"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"/"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"DenyPwdHack"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"log")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 检测到攻击时需要针对攻击IP封禁的端口,可以将ssh/luci/ftp等端口加上")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"Deny_Port"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"22,443"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"INPUT_RULE"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"INPUT -p tcp -m multiport --dports '),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$Deny_Port"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," -j "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$ChainName"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"')]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},'## 日志关键字,每个关键字可以用"|"号隔开,支持grep的正则表达式')]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 注: SSH 攻击可以大量出现四种关键字：Invalid user/Failed password for/Received disconnect from/Disconnected from authenticating")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},'##     Luci 攻击可以出现"luci: failed login on / for root from xx.xx.xx.xx"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"LOG_KEY_WORD"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"auth\\.info\\s+sshd.*Failed password for|luci:\\s+failed\\s+login|auth\\.info.*sshd.*Connection closed by.*port.*preauth"')]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},'## 白名单IP可以用"|"号隔开,支持grep的正则表达式')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"exclude_ip"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"192.168.|127.0.0.1"')]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 失败次数")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"Failed_times"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"5")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 黑名单过期时间,单位小时,3个月2160小时")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"BlackList_exp"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2160")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 日志时间")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"LOG_DT"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'`date "+%Y-%m-%d %H:%M:%S"`')]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 判断链是否存在")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"iptables"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"n"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," --"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"list"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $ChainName "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," /"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"dev"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"/"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 2"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">&"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," [[ $"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"ne"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]] ; "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"then")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  iptables"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"N"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $ChainName")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  echo"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "['),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$LOG_DT"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"] iptables -N "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$ChainName"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," >>"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $LOG_DEST")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"fi")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 判断INPUT跳到链的规则是否存在")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"iptables"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"C"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $INPUT_RULE "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," /"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"dev"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"/"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 2"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">&"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," [[ $"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"ne"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]] ; "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"then")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  iptables"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"I"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $INPUT_RULE")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  echo"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "['),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$LOG_DT"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"] iptables -I "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$INPUT_RULE"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," >>"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $LOG_DEST")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"fi")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"DenyIPLIst"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"`logread \\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},`  | awk '/'"`),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$LOG_KEY_WORD"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},`"'/ {for(i=1;i<=NF;i++) \\`)]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  if("),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$i"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"~/^(([0-9]{1,2}|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]{1,2}|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/) \\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  print "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$i"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"}' \\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'  | grep -v "'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"${exclude_ip}"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'" \\')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  | sort | uniq -c \\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},`  | awk '{if($1>'"`),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$Failed_times"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"\"') print $2}'`")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"IPList_sum"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'`echo "'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"${DenyIPLIst}"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'" | wc -l`')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," [[ $IPList_sum "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"ne"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]];"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"then")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"  for"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," i"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," in"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ${"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"DenyIPLIst"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    do")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    iptables"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"vnL"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $ChainName "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"|"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," grep"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"q"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $i")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    [[ $"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"ne"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]] "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&&"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," iptables"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"A"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $ChainName "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"s"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $i "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"m"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," comment"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," --"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"comment"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "Added at '),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$LOG_DT"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' by DenyPwdHack"'),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"j"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," DROP"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," \\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"     &&"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," echo"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "['),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$LOG_DT"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"] iptables -A "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$ChainName"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," -s "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$i"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' -j DROP"'),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," >>"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $LOG_DEST")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    done")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"fi")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 黑名单过期删除")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"ChainList"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"`iptables --line-numbers -nL "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$ChainName"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," |\\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  awk '/Added at/ {for(i=1;i<=NF;i++) if("),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$i"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'~/[0-9]{4}(-[0-9]{2}){2}/) print $1","'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$i"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},`" "$(i+1)}' |\\`)]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  sort -rn`")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 链表必须从后端删除,如果从前端删除,后端的实际rulenum会变")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"ChainList_num"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'`echo "'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"${ChainList}"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'" | grep -v "^$" | wc -l`')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," [[ ${"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"#ChainList} -ne 0 ]] && [[ $ChainList_num -gt 0 ]] ; then")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"for"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," tl"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," in"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," `seq 1 "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$ChainList_num"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"`")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"do")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  Dtime"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'`echo "'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"${ChainList}"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},`" | sed -n ''"`),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$tl"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"\"'p' | awk -F, '{print $2}'`")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  Stime"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'`date -d "'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$Dtime"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'" +%s`')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  Ntime"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"`date +%s`")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"  if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," [[ $(($Ntime "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $Stime)) "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"ge"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $(($BlackList_exp "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 3600"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")) ]] ; "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"then")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    RuleNum"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'`echo "'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"${ChainList}"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},`" | sed -n ''"`),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$tl"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"\"'p' | awk -F, '{print $1}'`")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    iptables"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"D"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $ChainName $RuleNum")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," [[ $"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"eq"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]] ; "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"then")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"      echo"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "['),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$LOG_DT"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"] iptables -D "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$ChainName"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $RuleNum"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," >>"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $LOG_DEST")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    else")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"      echo"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "['),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$LOG_DT"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"] execute delete failed: iptables -D "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$ChainName"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $RuleNum"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," >>"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $LOG_DEST")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    fi")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  fi")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"done")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"fi")])])]),i("button",{class:"collapse"})],-1)),h[16]||(h[16]=i("h2",{id:"实际使用源码-邮件通知bug-后续修复",tabindex:"-1"},[s("实际使用源码（邮件通知BUG，后续修复） "),i("a",{class:"header-anchor",href:"#实际使用源码-邮件通知bug-后续修复","aria-label":'Permalink to "实际使用源码（邮件通知BUG，后续修复）"'},"​")],-1)),h[17]||(h[17]=i("h3",{id:"添加修改自定义功能",tabindex:"-1"},[s("添加修改自定义功能 "),i("a",{class:"header-anchor",href:"#添加修改自定义功能","aria-label":'Permalink to "添加修改自定义功能"'},"​")],-1)),h[18]||(h[18]=i("h4",{id:"读取logread系统日志最后100行",tabindex:"-1"},[s("读取logread系统日志最后100行 "),i("a",{class:"header-anchor",href:"#读取logread系统日志最后100行","aria-label":'Permalink to "读取logread系统日志最后100行"'},"​")],-1)),h[19]||(h[19]=i("div",{style:{"max-height":"300px"},class:"language-php vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"php"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"#!/bin/bash")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# 获取文件最后100行数据")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"tail"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"n"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"100"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," /"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"tmp"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"/"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"system"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"log")])])]),i("button",{class:"collapse"})],-1)),h[20]||(h[20]=i("h3",{id:"封禁ip通知发送至邮箱",tabindex:"-1"},[s("封禁IP通知发送至邮箱 "),i("a",{class:"header-anchor",href:"#封禁ip通知发送至邮箱","aria-label":'Permalink to "封禁IP通知发送至邮箱"'},"​")],-1)),h[21]||(h[21]=i("div",{style:{"max-height":"300px"},class:"language-php vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"php"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 通知邮件发送")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," [[ $"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"eq"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]] ; "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"then"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}}," //判断上一步命令（封禁IP或初始创建iptables链）是否成功，成功则发送邮件")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"  # 获取文件包含“iptables -A DenyPwdHack -s”且读取最后10行")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  DenyIpList"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'`cat /root/DenyPwdHack.log | grep "iptables -A DenyPwdHack -s" | tail -n -10`')]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"  # 发送至个人邮箱")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  echo"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$DenyIpList"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," |"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," mutt"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"s"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "IP封禁提醒"'),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," xxxxxxxx"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"@"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"qq"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"com")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"fi")])])]),i("button",{class:"collapse"})],-1)),h[22]||(h[22]=i("h3",{id:"denypwdhack-sh-集成自定义功能版",tabindex:"-1"},[s("DenyPwdHack.sh（集成自定义功能版） "),i("a",{class:"header-anchor",href:"#denypwdhack-sh-集成自定义功能版","aria-label":'Permalink to "DenyPwdHack.sh（集成自定义功能版）"'},"​")],-1)),h[23]||(h[23]=i("div",{style:{"max-height":"300px"},class:"language-php vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"php"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"#!/bin/ash")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## OpenWRT 版本判断")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## Vfile=/etc/banner")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## OWTV=`awk 'BEGIN{IGNORECASE=1}/openwrt/ {split($2,v,\".\"); print v[1]}' $Vfile`")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},'## [[ $OWTV -lt 18 ]] && echo "OpenWRT version must be >= 18" && exit 1')]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 黑名单所在iptables链表")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"ChainName"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"DenyPwdHack")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 日志路径")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"LOG_DEST"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=/"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"root"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"/"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"DenyPwdHack"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"log")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 检测到攻击时需要针对攻击IP封禁的端口,可以将ssh/luci/ftp等端口加上")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"Deny_Port"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"36875"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"INPUT_RULE"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"INPUT -p tcp -m multiport --dports '),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$Deny_Port"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," -j "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$ChainName"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"')]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},'## 日志关键字,每个关键字可以用"|"号隔开,支持grep的正则表达式')]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 注: SSH 攻击可以大量出现四种关键字：Invalid user/Failed password for/Received disconnect from/Disconnected from authenticating")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},'##     Luci 攻击可以出现"luci: failed login on / for root from xx.xx.xx.xx"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"LOG_KEY_WORD"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"auth\\.info\\s+sshd.*Failed password for|luci:\\s+failed\\s+login|auth\\.info.*sshd.*Connection closed by.*port.*preauth|Received disconnect from"')]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},'## 白名单IP可以用"|"号隔开,支持grep的正则表达式')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"exclude_ip"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"192.168.\\|127.0.0.1\\|112.45.125."')]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 失败次数")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"Failed_times"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"10")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 黑名单过期时间,单位分钟")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"BlackList_exp"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"20")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 日志时间")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"LOG_DT"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'`date "+%Y-%m-%d %H:%M:%S"`')]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 判断链是否存在")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"iptables"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"n"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," --"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"list"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $ChainName "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," /"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"dev"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"/"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 2"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">&"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," [[ $"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"ne"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]] ; "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"then")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  iptables"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"N"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $ChainName")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  echo"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "['),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$LOG_DT"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"] iptables -N "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$ChainName"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," >>"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $LOG_DEST")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"fi")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 判断INPUT跳到链的规则是否存在")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"iptables"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"C"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $INPUT_RULE "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," /"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"dev"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"/"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 2"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">&"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," [[ $"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"ne"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]] ; "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"then")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  iptables"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"I"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $INPUT_RULE")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  echo"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "['),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$LOG_DT"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"] iptables -I "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$INPUT_RULE"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," >>"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $LOG_DEST")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"fi")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"DenyIPLIst"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"`tail -n -100 /tmp/system.log \\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},`  | awk '/'"`),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$LOG_KEY_WORD"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},`"'/ {for(i=1;i<=NF;i++) \\`)]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  if("),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$i"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"~/^(([0-9]{1,2}|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]{1,2}|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/) \\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  print "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$i"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"}' \\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'  | grep -v "'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"${exclude_ip}"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'" \\')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  | sort | uniq -c \\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},`  | awk '{if($1>'"`),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$Failed_times"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"\"') print $2}'`")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"IPList_sum"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'`echo "'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"${DenyIPLIst}"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'" | wc -l`')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," [[ $IPList_sum "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"ne"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]];"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"then")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"  for"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," i"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," in"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ${"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"DenyIPLIst"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    do")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    iptables"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"vnL"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $ChainName "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"|"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," grep"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"q"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $i")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    [[ $"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"ne"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]] "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&&"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," iptables"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"A"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $ChainName "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"s"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $i "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"m"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," comment"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," --"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"comment"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "Added at '),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$LOG_DT"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' by DenyPwdHack"'),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"j"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," DROP"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," \\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"     &&"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," echo"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "['),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$LOG_DT"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"] iptables -A "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$ChainName"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," -s "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$i"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' -j DROP"'),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," >>"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $LOG_DEST")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    done")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"fi")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 通知邮件发送")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," [[ $"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"eq"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]] ; "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"then")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"  # 获取文件包含“iptables -A DenyPwdHack -s”")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  DenyIpList"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'`cat /root/DenyPwdHack.log | grep "iptables -A DenyPwdHack -s" | tail -n -10`')]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"  # 发送至个人邮箱")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  echo"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$DenyIpList"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," |"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," mutt"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"s"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "IP封禁提醒"'),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," xxxxxxxx"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"@"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"qq"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"com")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"fi")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 黑名单过期删除")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"ChainList"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"`iptables --line-numbers -nL "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$ChainName"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," |\\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  awk '/Added at/ {for(i=1;i<=NF;i++) if("),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$i"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'~/[0-9]{4}(-[0-9]{2}){2}/) print $1","'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$i"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},`" "$(i+1)}' |\\`)]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  sort -rn`")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 链表必须从后端删除,如果从前端删除,后端的实际rulenum会变")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"ChainList_num"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'`echo "'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"${ChainList}"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'" | grep -v "^$" | wc -l`')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," [[ ${"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"#ChainList} -ne 0 ]] && [[ $ChainList_num -gt 0 ]] ; then")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"for"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," tl"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," in"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," `seq 1 "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$ChainList_num"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"`")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"do")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  Dtime"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'`echo "'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"${ChainList}"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},`" | sed -n ''"`),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$tl"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"\"'p' | awk -F, '{print $2}'`")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  Stime"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'`date -d "'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$Dtime"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'" +%s`')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  Ntime"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"`date +%s`")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"  if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," [[ $(($Ntime "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $Stime)) "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"ge"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $(($BlackList_exp "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 60"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")) ]] ; "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"then")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    RuleNum"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'`echo "'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"${ChainList}"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},`" | sed -n ''"`),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$tl"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"\"'p' | awk -F, '{print $1}'`")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    iptables"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"D"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $ChainName $RuleNum")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," [[ $"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"eq"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]] ; "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"then")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"      echo"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "['),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$LOG_DT"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"] iptables -D "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$ChainName"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $RuleNum"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," >>"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $LOG_DEST")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    else")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"      echo"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "['),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$LOG_DT"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"] execute delete failed: iptables -D "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$ChainName"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $RuleNum"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," >>"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $LOG_DEST")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    fi")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  fi")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"done")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"fi")])])]),i("button",{class:"collapse"})],-1)),h[24]||(h[24]=i("h3",{id:"添加计划任务",tabindex:"-1"},[s("添加计划任务 "),i("a",{class:"header-anchor",href:"#添加计划任务","aria-label":'Permalink to "添加计划任务"'},"​")],-1)),h[25]||(h[25]=i("ul",null,[i("li",null,[i("code",null,"*/10 * * * * /root/DenyPwdHack.sh")])],-1)),h[26]||(h[26]=i("h3",{id:"查询",tabindex:"-1"},[s("查询 "),i("a",{class:"header-anchor",href:"#查询","aria-label":'Permalink to "查询"'},"​")],-1)),h[27]||(h[27]=i("h4",{id:"封堵日志",tabindex:"-1"},[s("封堵日志 "),i("a",{class:"header-anchor",href:"#封堵日志","aria-label":'Permalink to "封堵日志"'},"​")],-1)),h[28]||(h[28]=i("ul",null,[i("li",null,[i("code",null,"cat DenyPwdHack.log")])],-1)),h[29]||(h[29]=i("h4",{id:"查询iptables条目",tabindex:"-1"},[s("查询iptables条目 "),i("a",{class:"header-anchor",href:"#查询iptables条目","aria-label":'Permalink to "查询iptables条目"'},"​")],-1)),h[30]||(h[30]=i("ul",null,[i("li",null,[i("code",null,"iptables -L DenyPwdHack")])],-1)),h[31]||(h[31]=i("h4",{id:"删除链",tabindex:"-1"},[s("删除链 "),i("a",{class:"header-anchor",href:"#删除链","aria-label":'Permalink to "删除链"'},"​")],-1)),h[32]||(h[32]=i("ul",null,[i("li",null,[i("code",null,"iptables -D DenyPwdHack 1")])],-1)),h[33]||(h[33]=i("h2",{id:"邮件通知bug修复",tabindex:"-1"},[s("邮件通知BUG修复 "),i("a",{class:"header-anchor",href:"#邮件通知bug修复","aria-label":'Permalink to "邮件通知BUG修复"'},"​")],-1)),h[34]||(h[34]=i("ul",null,[i("li",null,"运行一段发现，在无封禁IP时，任然触发邮件通知。")],-1)),h[35]||(h[35]=i("h3",{id:"改进",tabindex:"-1"},[s("改进 "),i("a",{class:"header-anchor",href:"#改进","aria-label":'Permalink to "改进"'},"​")],-1)),h[36]||(h[36]=i("ul",null,[i("li",null,"改变增加iptables DenyPwdHack条目的日志位置。"),i("li",null,"shell判断文件MD5是否有变化。")],-1)),h[37]||(h[37]=i("h3",{id:"检测md5脚本",tabindex:"-1"},[s("检测MD5脚本 "),i("a",{class:"header-anchor",href:"#检测md5脚本","aria-label":'Permalink to "检测MD5脚本"'},"​")],-1)),h[38]||(h[38]=i("div",{style:{"max-height":"300px"},class:"language-php vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"php"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"#!/bin/bash")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 检测DenyPwdHackIP.log是否有新增IP。发送通知邮件")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"#读取封禁IP日志")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"DenyIpList"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$("),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"cat"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," /"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"root"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"/"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"DenyPwdHackIP"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"log"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"cd"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," /"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"root")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"#判断DenyPwdHackIP.log文件有无改变，如果改变了需要发送通知邮件")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"md5_old"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"`cat DenyPwdHackIP.md5`")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"md5_new"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"`md5sum DenyPwdHackIP.log |awk '{print $1}'`")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," [[ $md5_old "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $md5_new ]];"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"then")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  echo"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$md5_new"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," >"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," DenyPwdHackIP"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"md5")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  echo"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$DenyIpList"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," |"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," mutt"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"s"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "IP封禁提醒"'),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," xxxxxxxx"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"@"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"qq"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"com")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"fi")])])]),i("button",{class:"collapse"})],-1)),h[39]||(h[39]=i("h3",{id:"denypwdhack-sh-改进后命令",tabindex:"-1"},[s("DenyPwdHack.sh（改进后命令） "),i("a",{class:"header-anchor",href:"#denypwdhack-sh-改进后命令","aria-label":'Permalink to "DenyPwdHack.sh（改进后命令）"'},"​")],-1)),h[40]||(h[40]=i("div",{style:{"max-height":"300px"},class:"language-php vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"php"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"#!/bin/bash")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## OpenWRT 版本判断")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## Vfile=/etc/banner")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## OWTV=`awk 'BEGIN{IGNORECASE=1}/openwrt/ {split($2,v,\".\"); print v[1]}' $Vfile`")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},'## [[ $OWTV -lt 18 ]] && echo "OpenWRT version must be >= 18" && exit 1')]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 黑名单所在iptables链表")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"ChainName"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"DenyPwdHack")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 日志路径")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"LOG_Deny_IP"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=/"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"root"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"/"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"DenyPwdHackIP"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"log")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"LOG_DEST"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=/"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"root"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"/"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"DenyPwdHack"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"log")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 检测到攻击时需要针对攻击IP封禁的端口,可以将ssh/luci/ftp等端口加上")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"Deny_Port"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"36875"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"INPUT_RULE"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"INPUT -p tcp -m multiport --dports '),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$Deny_Port"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," -j "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$ChainName"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"')]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},'## 日志关键字,每个关键字可以用"|"号隔开,支持grep的正则表达式')]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 注: SSH 攻击可以大量出现四种关键字：Invalid user/Failed password for/Received disconnect from/Disconnected from authenticating")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},'##     Luci 攻击可以出现"luci: failed login on / for root from xx.xx.xx.xx"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"LOG_KEY_WORD"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"auth\\.info\\s+sshd.*Failed password for|luci:\\s+failed\\s+login|auth\\.info.*sshd.*Connection closed by.*port.*preauth|Received disconnect from"')]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},'## 白名单IP可以用"|"号隔开,支持grep的正则表达式')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"exclude_ip"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"192.168.\\|127.0.0.1\\|112.45.125."')]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 失败次数")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"Failed_times"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"10")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 黑名单过期时间,单位分钟")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"BlackList_exp"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"20")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 日志时间")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"LOG_DT"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'`date "+%Y-%m-%d %H:%M:%S"`')]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 判断链是否存在")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"iptables"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"n"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," --"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"list"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $ChainName "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," /"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"dev"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"/"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 2"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">&"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," [[ $"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"ne"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]] ; "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"then")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  iptables"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"N"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $ChainName")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  echo"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "['),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$LOG_DT"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"] iptables -N "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$ChainName"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," >>"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $LOG_DEST")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"fi")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 判断INPUT跳到链的规则是否存在")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"iptables"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"C"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $INPUT_RULE "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," /"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"dev"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"/"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"null"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 2"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">&"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," [[ $"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"ne"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]] ; "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"then")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  iptables"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"I"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $INPUT_RULE")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  echo"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "['),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$LOG_DT"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"] iptables -I "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$INPUT_RULE"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," >>"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $LOG_DEST")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"fi")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"DenyIPLIst"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"`tail -n -100 /tmp/system.log \\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},`  | awk '/'"`),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$LOG_KEY_WORD"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},`"'/ {for(i=1;i<=NF;i++) \\`)]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  if("),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$i"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"~/^(([0-9]{1,2}|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]{1,2}|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/) \\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  print "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$i"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"}' \\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'  | grep -v "'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"${exclude_ip}"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'" \\')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  | sort | uniq -c \\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},`  | awk '{if($1>'"`),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$Failed_times"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"\"') print $2}'`")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"IPList_sum"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'`echo "'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"${DenyIPLIst}"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'" | wc -l`')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," [[ $IPList_sum "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"ne"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]];"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"then")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"  for"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," i"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," in"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ${"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"DenyIPLIst"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    do")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    iptables"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"vnL"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $ChainName "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"|"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," grep"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"q"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $i")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    [[ $"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"ne"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]] "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&&"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," iptables"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"A"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $ChainName "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"s"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $i "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"m"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," comment"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," --"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"comment"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "Added at '),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$LOG_DT"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' by DenyPwdHack"'),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"j"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," DROP"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," \\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"     &&"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," echo"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "['),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$LOG_DT"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"] iptables -A "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$ChainName"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," -s "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$i"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' -j DROP"'),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," >>"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $LOG_Deny_IP")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    done")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"fi")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 黑名单过期删除")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"ChainList"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"`iptables --line-numbers -nL "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$ChainName"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," |\\")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  awk '/Added at/ {for(i=1;i<=NF;i++) if("),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$i"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'~/[0-9]{4}(-[0-9]{2}){2}/) print $1","'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$i"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},`" "$(i+1)}' |\\`)]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  sort -rn`")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 链表必须从后端删除,如果从前端删除,后端的实际rulenum会变")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"ChainList_num"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'`echo "'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"${ChainList}"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'" | grep -v "^$" | wc -l`')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," [[ ${"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"#ChainList} -ne 0 ]] && [[ $ChainList_num -gt 0 ]] ; then")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"for"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," tl"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," in"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," `seq 1 "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$ChainList_num"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"`")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"do")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  Dtime"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'`echo "'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"${ChainList}"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},`" | sed -n ''"`),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$tl"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"\"'p' | awk -F, '{print $2}'`")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  Stime"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'`date -d "'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$Dtime"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'" +%s`')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  Ntime"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"`date +%s`")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"  if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," [[ $(($Ntime "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $Stime)) "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"ge"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $(($BlackList_exp "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 60"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")) ]] ; "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"then")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    RuleNum"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'`echo "'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"${ChainList}"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},`" | sed -n ''"`),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$tl"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"\"'p' | awk -F, '{print $1}'`")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    iptables"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"D"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $ChainName $RuleNum")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," [[ $"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"eq"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ]] ; "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"then")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"      echo"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "['),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$LOG_DT"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"] iptables -D "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$ChainName"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $RuleNum"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," >>"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $LOG_DEST")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    else")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"      echo"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "['),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$LOG_DT"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"] execute delete failed: iptables -D "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$ChainName"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $RuleNum"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," >>"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $LOG_DEST")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    fi")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  fi")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"done")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"fi")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"## 检测DenyPwdHackIP.log是否有新增IP。发送通知邮件")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"#读取封禁IP日志")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"DenyIpList"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$("),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"cat"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," /"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"root"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"/"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"DenyPwdHackIP"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"log"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," |"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," tail"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"n"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"10"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"cd"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," /"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"root")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"#判断DenyPwdHackIP.log文件有无改变，如果改变了需要发送通知邮件")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"md5_old"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"`cat DenyPwdHackIP.md5`")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"md5_new"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"`md5sum DenyPwdHackIP.log |awk '{print $1}'`")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," [[ $md5_old "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," $md5_new ]];"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"then")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  echo"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$md5_new"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," >"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," DenyPwdHackIP"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"md5")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  echo"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"$DenyIpList"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," |"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," mutt"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," -"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"s"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "IP封禁提醒"'),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," xxxxxxxx"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"@"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"qq"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"com")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"fi")])])]),i("button",{class:"collapse"})],-1)),h[41]||(h[41]=i("hr",null,null,-1)),h[42]||(h[42]=i("p",null,"#openwrt #linux",-1))]),"main-header":a(()=>[k(l.$slots,"main-header")]),"main-header-after":a(()=>[k(l.$slots,"main-header-after")]),"main-nav":a(()=>[k(l.$slots,"main-nav")]),"main-content":a(()=>[k(l.$slots,"main-content")]),"main-content-after":a(()=>[k(l.$slots,"main-content-after")]),"main-nav-before":a(()=>[k(l.$slots,"main-nav-before")]),"main-nav-after":a(()=>[k(l.$slots,"main-nav-after")]),comment:a(()=>[k(l.$slots,"comment")]),footer:a(()=>[k(l.$slots,"footer")]),aside:a(()=>[k(l.$slots,"aside")]),"aside-custom":a(()=>[k(l.$slots,"aside-custom")]),default:a(()=>[k(l.$slots,"default")]),_:3},8,["frontmatter"])}}};export{b as default};
